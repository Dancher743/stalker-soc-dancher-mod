--[[-----------------------------------------------------------------------------------------------
 File         : dmx_mod.script
 Description  : Служебные и квестовые функции
 Copyright    : DMX MOD
 Author       : Shadows & Co
 Date         : 01.09.2009
--]]-----------------------------------------------------------------------------------------------

-- Установка меток
function add_mapspot(id)
	if id == nil then return end
	local obj = alife():object(id)
	if obj == nil then return end
	local sid = obj.m_story_id
	
    if sid==507 then level.map_add_object_spot(id, "leader_npc_mapspot", "Главнокомандующий")	-- Воронин	
    elseif sid==707 then level.map_add_object_spot(id, "leader_npc_mapspot", "Главнокомандующий")	-- Лукаш
	elseif sid==6 and level.name() == "l01_escape" then level.map_add_object_spot(id, "leader_npc_mapspot", "Главнокомандующий") -- Волк
	elseif sid==22 then level.map_add_object_spot(id, "leader_npc_mapspot", "Главнокомандующий") -- Фанат
    elseif sid==003 then level.map_add_object_spot(id, "trader_npc_mapspot", "Торговец") -- Сидорович
    elseif sid==500 then level.map_add_object_spot(id, "trader_npc_mapspot_small", "Торговец") -- Бармен
	elseif sid==506 then level.map_add_object_spot(id, "trader_npc_mapspot", "Торговец") -- Петренко
    elseif sid==902 then level.map_add_object_spot(id, "trader_npc_mapspot", "Торговец") -- Сахаров
    elseif sid==734 then level.map_add_object_spot(id, "trader_npc_mapspot", "Торговец") -- Скряга
	elseif sid==5481 then level.map_add_object_spot(id, "guider_npc_mapspot", "Проводник") -- Проводник в Баре
	elseif sid==5482 then level.map_add_object_spot(id, "guider_npc_mapspot", "Проводник") -- Проводник на Кордоне
	elseif sid==5483 then level.map_add_object_spot(id, "guider_npc_mapspot", "Проводник") -- Проводник на Янтаре
	elseif sid==5485 then level.map_add_object_spot(id, "repair_npc_mapspot", "Механик") -- Механик в Баре
	elseif sid==775 then level.map_add_object_spot(id, "repair_npc_mapspot", "Механик") -- Шуруп
	elseif sid==515 then level.map_add_object_spot(id, "informer_npc_mapspot_small", "Информатор") -- Осведомитель в баре
	elseif aem_manager.is_npc_arena_admin(id) then
		-- Админ арены в баре
		if has_alife_info("aem_go_bar") then
			level.map_add_object_spot(id, "admin_npc_mapspot_small", "Администратор") 
		else
			level.map_add_object_spot(id, "admin_npc_mapspot", "Администратор")
		end
	elseif sid==7 and has_alife_info("dar_x18_dream") 
		then level.map_add_object_spot(id, "collector_npc_mapspot", "Коллекционер") -- Толик 
	end
end

-- Удаление меток в оффлайне
function remove_mapspot(id)
	if id == nil then return end
	local obj = alife():object(id)
	if obj == nil then return end
	local sid = obj.m_story_id
	
    if sid==507 then level.map_remove_object_spot(id, "leader_npc_mapspot") -- Воронин
    elseif sid==707 then level.map_remove_object_spot(id, "leader_npc_mapspot") -- Лукаш
	elseif sid==6 and level.name() == "l01_escape" then level.map_remove_object_spot(id, "leader_npc_mapspot") -- Волк
	elseif sid==22 then level.map_remove_object_spot(id, "leader_npc_mapspot") -- Фанат
    elseif sid==003 then level.map_remove_object_spot(id, "trader_npc_mapspot") -- Сидорович
    elseif sid==500 then level.map_remove_object_spot(id, "trader_npc_mapspot_small") -- Бармен
	elseif sid==506 then level.map_remove_object_spot(id, "trader_npc_mapspot") -- Петренко
    elseif sid==902 then level.map_remove_object_spot(id, "trader_npc_mapspot") -- Сахаров
	elseif sid==734 then level.map_remove_object_spot(id, "trader_npc_mapspot") -- Скряга
	elseif sid==5481 then level.map_remove_object_spot(id, "guider_npc_mapspot") -- Проводник в Баре
	elseif sid==5482 then level.map_remove_object_spot(id, "guider_npc_mapspot") -- Проводник на Кордоне
	elseif sid==5483 then level.map_remove_object_spot(id, "guider_npc_mapspot") -- Проводник на Янтаре
	elseif sid==5485 then level.map_remove_object_spot(id, "repair_npc_mapspot") -- Механик в Баре
	elseif sid==775 then level.map_remove_object_spot(id, "repair_npc_mapspot") -- Шуруп
	elseif sid==515 then level.map_remove_object_spot(id, "informer_npc_mapspot_small") -- Осведомитель в баре
	elseif aem_manager.is_npc_arena_admin(id) then 
		-- Админ арены в баре
		level.map_remove_object_spot(id, "admin_npc_mapspot_small")
		level.map_remove_object_spot(id, "admin_npc_mapspot")
	elseif sid==7 and has_alife_info("dar_x18_dream") then level.map_remove_object_spot(id, "collector_npc_mapspot") -- Толик
    end
end

-- Обновление меток по запросу
function force_update_mapspot(id)
	remove_mapspot(id)
	add_mapspot(id)
end